/*! angular-dragtable - v0.1.0 - 2015-06-02 */
angular.module("dragtable",[]).value("mode","extension").value("version","v0.1.0").directive("draggable",["$window","$document","dragtableHelper",function(a,b,c){function d(a,d){function e(d){d.preventDefault(),a.origNode=d.target;var e=c.eventPosition(d);if(a.origNode=c.findUp(a.origNode,/T[DH]/),a.startCol=c.findColumn(a.table,e.x),-1!==a.startCol){var h=c.fullCopy(a.table,!1);h.style.margin="0",a.table.tHead&&h.appendChild(c.copySectionColumn(a.table.tHead,a.startCol)),c.forEach(a.table.tBodies,function(b){h.appendChild(c.copySectionColumn(b,a.startCol))}),a.table.tFoot&&h.appendChild(c.copySectionColumn(a.table.tFoot,a.startCol));var i=c.absolutePosition(a.origNode,!0);h.style.position="absolute",h.style.left=i.x+"px",h.style.top=i.y+"px",h.style.width=a.origNode.offsetWidth+"px",h.style.height=a.origNode.offsetHeight+"px",h.style.opacity=.7,a.addedNode=!1,a.tableContainer=a.table.parentNode||b.body,a.elNode=h,a.cursorStartX=e.x,a.cursorStartY=e.y,a.elStartLeft=parseInt(a.elNode.style.left,10),a.elStartTop=parseInt(a.elNode.style.top,10),isNaN(a.elStartLeft)&&(a.elStartLeft=0),isNaN(a.elStartTop)&&(a.elStartTop=0),a.elNode.style.zIndex=++a.zIndex,b.bind("mousemove",f),b.bind("mouseup",g)}}function f(b){var d=c.eventPosition(b),e=a.cursorStartX-d.x,f=a.cursorStartY-d.y;!a.addedNode&&e*e+f*f>a.dragRadius2&&(a.tableContainer.insertBefore(a.elNode,a.table),a.addedNode=!0);var g=a.elNode.style;g.left=a.elStartLeft+d.x-a.cursorStartX+"px",g.top=a.elStartTop+d.y-a.cursorStartY+"px"}function g(d){if(b.unbind("mousemove",f),b.unbind("mouseup",g),a.addedNode){a.tableContainer.removeChild(a.elNode);var e=c.eventPosition(d),h=c.absolutePosition(a.table);if(!(e.y<h.y||e.y>h.y+a.table.offsetHeight)){var i=c.findColumn(a.table,e.x);-1!==i&&i!==a.startCol&&(c.moveColumn(a.table,a.startCol,i),c.arrayMove(a.order,a.startCol,i),a.draggable=a.order,a.onDragEnd({$start:a.startCol,$target:i}),a.$apply())}}}function h(){angular.isUndefined(a.draggable)&&(a.draggable=a.order),a.order!=a.draggable&&(console.log("Draggable: %j",a.draggable),console.log("Order: %j",a.order),console.log("WHAT"),angular.forEach(a.draggable,function(b,d){angular.forEach(a.order,function(e,f){return d==f&&e!=b?(c.moveColumn(a.table,e,b),void c.arrayMove(a.order,e,b)):void 0})}),console.log("Draggable: %j",a.draggable),console.log("Order: %j",a.order))}a.table=d[0],a.order=[],a.dragRadius2=100;for(var i=a.table.tHead.rows[0].cells,j=0;j<i.length;j++){a.order.push(j);var k=angular.element(i[j]);k.on("touchstart mousedown",e)}h(),a.$watch("draggable",function(b,c){b!=c&&b!=a.order&&h()})}return{restrict:"A",scope:{draggable:"=",onDragEnd:"&"},link:d}}]).factory("dragtableHelper",["$window","$document",function(a,b){var c=function(a,b,c){var d=a[b];a.splice(b,1),a.splice(c,0,d)},d=function(a,b){var c=f(a,!1);return m(a.rows,function(a){var d=a.cells[b],e=f(a,!1);a.offsetHeight&&(e.style.height=a.offsetHeight+"px");var g=f(d,!0);d.offsetWidth&&(g.style.width=d.offsetWidth+"px"),e.appendChild(g),c.appendChild(e)}),c},e=function(a,b,c){for(var d,e=a.rows.length;e--;){d=a.rows[e];var f=d.removeChild(d.cells[b]);c<d.cells.length?d.insertBefore(f,d.cells[c]):d.appendChild(f)}var g,h=a.tHead.rows[0].cells;for(g=0;g<h.length;g++)h[g].sorttable_columnindex=g},f=function(a,b){var c=a.cloneNode(b);return c.className=a.className,m(a.style,function(b,d){null!==b&&("string"!=typeof b||0!==b.length)&&(c.style[d]=a.style[d])}),c},g=function(a,b){var c,d=a.tHead.rows[0].cells;for(c=0;c<d.length;c++){var e=i(d[c]);if(e.x<=b&&b<=e.x+d[c].offsetWidth)return c}return-1},h=function(a){return{x:a.pageX,y:a.pageY}},i=function(c,d){var e=0,f=0;do{var g=a.getComputedStyle(c,"");if(d&&"relative"===g.position)break;if("fixed"===g.position){e+=parseInt(g.left,10),f+=parseInt(g.top,10),e+=b[0].body.scrollLeft,f+=b[0].body.scrollTop;break}e+=c.offsetLeft,f+=c.offsetTop,c=c.offsetParent}while(c);return{x:e,y:f}},j=function(a,b){do{if(a.nodeName&&-1!==a.nodeName.search(b))return a;a=a.parentNode}while(a)},k=function(a,b,c){var d,e=a.split("");for(d=0;d<e.length;d++)b.call(c,e[d],d,e)},l=function(a,b,c){var d;for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)},m=function(a,b,c){if(a){var d=Object,e=a instanceof Function;if(!e&&a.forEach instanceof Function)return void a.forEach(b,c);e?d=l:"string"==typeof a?d=k:"number"==typeof a.length&&(d=n),d(a,b,c)}},n=function(a,b,c){var d;for(d=0;d<a.length;d++)b.call(c,a[d],d,a)};return{arrayMove:c,copySectionColumn:d,moveColumn:e,fullCopy:f,findColumn:g,eventPosition:h,absolutePosition:i,findUp:j,strForEach:k,fnForEach:l,forEach:m,arForEach:n}}]);
//# sourceMappingURL=angular-dragtable.map